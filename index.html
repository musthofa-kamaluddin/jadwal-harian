<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UTBK Focus</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PWA -->
  <link rel="manifest" href="/jadwal-harian/manifest.json">
  <meta name="theme-color" content="#020617">
</head>

<body class="bg-slate-950 text-white">

<div class="fixed bottom-3 right-3 w-[92%] max-w-sm bg-slate-900 border border-slate-700 rounded-xl p-4">
  <h1 class="text-sm font-semibold">UTBK Focus</h1>
  <p class="text-xs text-slate-400 mb-2">Notifikasi jalan di background</p>

  <button id="enable"
    class="w-full mt-2 py-2 bg-indigo-600 rounded text-sm font-medium">
    Aktifkan Notifikasi
  </button>

  <p id="status" class="text-xs mt-2 text-green-400"></p>
</div>

<script>
/* ======================
   KONFIG GITHUB PAGES
   ====================== */
const BASE_PATH = "/jadwal-harian/";

/* ======================
   JADWAL
   ====================== */
const schedules = {
  weekday: ["04:45","16:30","19:00","21:00"],
  saturday: ["19:00","20:45"],
  sunday: ["05:00","07:00","09:15","13:00","15:00","19:00"]
};

function getTodaySchedule() {
  const d = new Date().getDay();
  if (d === 6) return schedules.saturday;
  if (d === 0) return schedules.sunday;
  return schedules.weekday;
}

/* ======================
   NOTIFICATION SETUP
   ====================== */
document.getElementById("enable").onclick = async () => {
  if (!("serviceWorker" in navigator)) {
    alert("Service Worker tidak didukung browser");
    return;
  }

  const perm = await Notification.requestPermission();
  if (perm !== "granted") {
    alert("Izin notifikasi ditolak");
    return;
  }

  const reg = await navigator.serviceWorker.register(
    BASE_PATH + "sw.js",
    { scope: BASE_PATH }
  );

  scheduleNotifications(reg);

  document.getElementById("status").innerText =
    "Notifikasi aktif. Jangan force close PWA.";
};

function scheduleNotifications(reg) {
  const now = new Date();
  const today = now.toISOString().split("T")[0];

  getTodaySchedule().forEach(time => {
    const date = new Date(`${today}T${time}:00`);
    if (date > now) {
      reg.showNotification("UTBK Focus", {
        body: `Waktunya belajar (${time})`,
        tag: time,
        requireInteraction: true,
        vibrate: [200, 100, 200]
      });
    }
  });
}
</script>

</body>
</html>
